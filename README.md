# Направления по улучшению инфраструктуры проекта

* [Появление DevOps-компетенций в команде и возможность управления архитектурой наших серверов](#p1)
* [Внедрение практики тестирования](#p2)
* [Изменение подхода к бэкапам](#p3)
* [Полноценное внедрение линтеров](#p4)
* [Переезд на GitHub](#p5)


<br>
<br>
<a name="p1"><h2>Появление DevOps-компетенций в команде и возможность управления архитектурой наших серверов</h2></a>

### Ликбез
> https://habr.com/ru/articles/469277/

### Вводные
**Польза от наличия DevOps компетенций в команде:**

1. **Быстрая доставка:** DevOps практики способствуют автоматизированной и быстрой поставке программного обеспечения в производственную среду. Это уменьшает время между разработкой новой функциональности и её выпуском на рынок.

2. **Автоматизация:** DevOps подход включает в себя автоматизацию различных этапов разработки, тестирования и развертывания. Это повышает эффективность процессов и снижает вероятность человеческих ошибок.

3. **Улучшенная совместимость:** Команды с DevOps компетенциями обеспечивают более гармоничное взаимодействие между разработкой и системным администрированием. Это способствует более гладкой интеграции и развертыванию приложений и сервисов.

4. **Отказоустойчивость:** DevOps позволяет создавать отказоустойчивую инфраструктуру, включая резервное копирование данных, масштабирование и обработку нагрузки.

5. **Мониторинг и анализ:** Культура DevOps включает в себя постоянный мониторинг работы приложений в производственной среде. Это позволяет быстро выявлять проблемы, улучшать производительность и принимать взвешенные решения на основе данных.

**Польза от описания инфраструктуры (Infrastructure as Code):**

1. **Повторяемость и масштабируемость:** Описание инфраструктуры как кода позволяет создавать и настраивать среды повторяемо и автоматически. Это особенно важно при масштабировании приложений под высокую нагрузку.

2. **Легкость восстановления:** Инфраструктура, описанная как код, упрощает восстановление среды после сбоев или ошибок. Это позволяет быстро восстановить работоспособность приложения и сократить время простоя.

3. **Управление изменениями:** Изменения в инфраструктуре могут быть отслежены и версионированы так же, как и изменения в коде приложения. Это облегчает контроль и управление изменениями.

4. **Инфраструктура как код:** Описывая инфраструктуру как код, вы создаете документацию, которая всегда актуальна. Это способствует лучшему пониманию инфраструктуры и облегчает совместную работу.

5. **Автоматизация развертывания:** Описание инфраструктуры как кода позволяет автоматизировать процессы развертывания и настройки среды. Это сокращает ручную работу и риск ошибок.

6. **Согласованность сред:** Описание инфраструктуры как кода обеспечивает согласованность между различными средами разработки, тестирования и продакшена.

Объединение DevOps компетенций с описанием инфраструктуры как кода существенно повышает эффективность, надежность и скорость разработки, а также упрощает управление инфраструктурой в долгосрочной перспективе.
Проблемы девопс так или иначе возникают, команда периодически тратит на это много ресурса. Если бы кто-то был погружен, он бы решал такие проблемы быстрее и остальная команда не отвлекалась, пул задач был бы реструктуризирован.

### Необходимо
- Документировать имеющуюся инфраструктуру - как настроены сервера (`nginx` и т.п.), как связаны между собой, что где развернуто
- Сформировать инструкции как развернуть повторно

### Желательно
- Провести аудит и избавиться от уже ненужного (н-р Redmine)
- Создать интерактивный реестр временных периодов (протухание сертификатов, оплата серверов и т.п.)
- тимлид осваивает компетенции девопса, инвестирует сколько-то ресурса в итерацию (около 5 баллов). Учитываем субъективный фактор - новый тип задач, восполнение пробелов в знаниях, отсюда высокий интерес.

### В идеале
- Внедрить миркосервисную архитектуру
- Использовать контейнеризацию (поместить сервисы в `docker`-контейнеры)
- Настроить разворачивание инфраструктуры при помощи инструментов для оркестрации множествами контейнеров (`Kubernetes`)

### Конкретные примеры недостатка DevOps компетенций в команде
- Проблема с миграциями на тестовых стендах. Периодически эта проблема возникает, на тестовом стенде появляются труднообъяснимые баги, которые на саммом деле не связаны с изменениями в коде. Съедает ресурс. Последний пример был совсем недавно, съел по нашим оценкам в баллах - от 3х.
- Была проблема с бэкапами - сисадмин на аутсорсе криво настроил процесс, бэкапы складывались не на нужный диск (хотя мы за него платили), а на прод. В результате прод забился и упал, у нас ушло несколько часов на выявление проблемы, потом какой-то ресурс на связь с сисадмином, чтобы его убедить, что он неправильно настроил. Он отпирался и говорил, что настроено всё ок, просто мистическим образом всё не так сработало.
- Была проблема с просроком сертификатов
- Из-за отсутсвия мониторинга работы серверов мы не знали, что у значительного количества клиентов (1 из 700) просто не работает часть сайта

### Наличие DevOps компетенций в команде позволит
- При системном решении проблемы миграций мы можем высвободить около 10% ресурса разработки (это разовое решение)
- Снять DevOps задачи с остальных членов команды и выполнять их быстрее за счет экспертизы в вопросе у носителя компетенций
- Значительно улучшить мониторинг работы серверов - выявлять ошибки доскриптового формирования ответа. Это позволит выявлять ситуации, когда часть сайта не работает.
- Ускорить работу сайта как при работе в админке, так и загрузка сайта для внешнего пользователя (н-р репликацией базы и/или шардированием) - пользователи перестанут жаловаться на медленную загрузку, ускорение выполнения запросов в админке, вырастут seo-показатели по скорость загрузки
- Настроить инфраструктуру для быстрого разворачивания сайта в случае аварии или при переезде - до 1-2 часов вместо недели или вообще бы не смогли это сделать самостоятельно
- Поменять подход к хостингу - н-р перейти на хостинг в облаке с настройкой балансера и автоматическим развертыванием дополнительных нод (инстансов приложения). При росте нагрузки это позволит держать скорость отклика сервера постоянной
- Поменять подход к использованию тестовых стендов - можно настроить инфраструктуру с автоматическим переворачиванием инстанса тестового окружения для конкретной задачи. Ускорит разработку за счет избавления от необходимости стоять в очереди на тестовый стенд. За счет этого можно будет проводить тестирование быстрее и получать ОС по задаче на 1-2 дня раньше, что ускорит разработку и сократит time-to-market

Не сможем дать ориентир по срокам, когда что может быть освоено и внедрено в работу.



<br>
<br>
<a name="p2"><h2>Внедрение практики тестирования</h2></a>

### Ликбез
> https://habr.com/ru/articles/45759/  
> https://habr.com/ru/companies/badoo/articles/345478/  
> https://habr.com/ru/companies/quadcode/articles/571818/ - альтернативно и обстоятельно о TDD. Полезно для общего развития

### Вводные
**Написание тестов для программного кода несёт множество пользы и является важной практикой в разработке программного обеспечения. На сегодняшний день написание тестов - это стандарт разработки. Вот некоторые из основных преимуществ:**

1. **Обеспечение корректности кода:** Тесты позволяют выявить ошибки и дефекты в коде, которые могли бы привести к неправильному поведению программы. Это помогает обнаружить проблемы на ранних этапах разработки и уменьшает вероятность возникновения ошибок в продакшене.

2. **Облегчение рефакторинга:** При внесении изменений в код (рефакторинге) существующие тесты проверяют, что функциональность программы остается неизменной. Таким образом, тесты обеспечивают уверенность в том, что рефакторинг не нарушает работоспособность.

3. **Документация и спецификация:** Тесты служат своеобразной документацией для кода. Они описывают ожидаемое поведение различных компонентов программы, что упрощает понимание функциональности для других разработчиков.

4. **Улучшение архитектуры:** Написание тестов обычно подразумевает разделение кода на более мелкие, независимые компоненты. Это способствует более четкой архитектуре, так как каждая компонента может быть протестирована отдельно.

5. **Автоматизированная проверка:** Тесты могут быть запущены автоматически, что позволяет быстро обнаруживать ошибки после каждого изменения кода. Это экономит время и снижает риск человеческой ошибки.

6. **Ускорение разработки:** В долгосрочной перспективе написание тестов может сэкономить время разработчиков, так как быстрее выявляются проблемы, исключается необходимость в ручном тестировании и отладке.

7. **Уверенность в качестве:** Наличие надежных тестов позволяет разработчикам и менеджерам быть уверенными в качестве продукта и его способности выполнять требуемые задачи.

Написание тестов требует времени и усилий, но оно окупается благодаря улучшенной стабильности и надежности кода. Различные подходы к тестированию включают модульное, интеграционное и функциональное тестирование, а также практики TDD (Test-Driven Development) и BDD (Behavior-Driven Development).

### Необходимо
- Создать архитектуру для написания тестов
- Начать покрывать код Unit-тестами
- Начать создавать функциональные тесты (есть стандарт для PHP - `Codeception`, библиотека для Yii2)

### Желательно
- Иметь тестировщика

### В идеале
- Иметь QA-инженера
- Реализовать автотесты
- Реализовать интеграционное тестирование
- Использовать методологию TDD

### Отсутствие практики тестирования в команде приводит к
- Каждый отдельный разработчик тратит около 50% ресурса на ручное тестирование, при этом это не защищает от возникновения ошибок на проде
- Периодически возникает необходимость тестирования на продакшене. Минус - подготовка коммита занимает дополнительное время (с использованием тестовой куки): нужно подготовить куку, реализовать два решения. Затраты по баллам на каждую такую подготовку (только на неё) 2-3.
- Накопление багов в проекте, которые периодически дают о себе знать (н-р задвоение товаров в корзине). Они отвлекают от уже спланированного и выполняемого спринта. Они раздувают поддержку в разы - допустим, поддержка съедала бы 1 балл в день у команды, но из-за этой причины - может доходить до 3х (в ущерб выполняемым в спринте задачам).
- Появление ошибок в частях проекта, которые не трогали при создании фичи (н-р отвал админки при внедрении кэша). Это плохо, т.к. это прямой путь проникновения багов на прод, внезапного возникновения критических багов, по аналогии с предыдущим пунком - отвлечение от задач в спринте.
- Значительному (слово неподходящее, но нецензурные мы здесь не используем) увеличению времени деплоя. При выкатке крупных фичей или серьезного рефакторинга, деплой растягивается на итерации (!). Это колоссальное количество ресурса вообще в никуда.

### Наличие практики тестирования в команде позволит
- Сэкономить от 10 часов в неделю рабочего времени каждого разработчика за счет автоматизации тестирования и наличия тестировщика (подробнее см. ниже). При этом математика такая: фактически на ручное тестирование будет тратиться на 20 часов меньше, но из них 10 часов пойдёт на написание тестов. Отсюда экономия в 10 часов.
- Снизить вероятность появления ошибок в частях проекта, покрытых тестами. Экономим ресурс на поддержке, на отвлечении на критические непредвиденные баги. Из последнего такие проблемы отъедали половину (!) ресурса разработки.
- Повысить качество релизов, обеспечить отсутствие критических и явных ошибок и деплоить так, как должен проходить деплой - без правок по продакшену, без откатывания веток обратно. Не нужно будет заниматься деплоем одной фичи на протяжении итераций.

### Наличие тестировщика в команде позволит
- Избавиться от появления ошибок в частях проекта, которые не трогали при создании фичи, но которые описаны тест-кейсами. Экономим ресурс на поддержке, на отвлечении на критические непредвиденные баги. Работает в синергии с написанием тестов разработчиками. Эти два направления друг друга дополняют, а друг без друга не являются полноценными.
- По деплою см. выше - синергирует с написанием тестов
- Быстрее находить и исправлять проблемы за счет точного описания сценариев возникновения. Экономит ресурс при работе с багами. Можно сократить такие задачи в 2-3 раза по затрачиваемому времени.
- Повысить качество ручного тестирования за счет специфических навыков, которые есть у тестировщика, но нет у программиста: незамыленный взгляд, умение сломать систему, тестирование на различных девайсах.
- На основании тест-кейсов собрать базу знаний о проекте - вариант документирования с точки зрения пользователя системы. Позволит взглянуть на работу нашего магазина в комплексе, выявить потенциально запутанные, неудобные или неочевидные механики для наших клиентов.



<br>
<br>
<a name="p3"><h2>Изменение подхода к бэкапам</h2></a>

### Ликбез
>https://habr.com/ru/companies/vk/articles/521190/

### Вводные
**`S3 (Simple Storage Service)` - это объектное хранилище в облаке. Вот некоторые преимущества использования S3-хранилища перед традиционными методами бэкапа:**

1. **Масштабируемость:** S3 предоставляет практически неограниченные масштабируемые возможности для хранения данных. Можно легко увеличивать объем хранилища по мере роста данных, без необходимости покупки и установки нового оборудования.

2. **Доступность и отказоустойчивость:** Данные, хранящиеся в S3, дублируются и реплицируются в разных зонах доступности и регионах, обеспечивая высокую доступность и защиту от потери данных в случае сбоев.

3. **Автоматическое управление:** S3 управляет деталями, связанными с уровнями хранения, резервными копиями, доступом и безопасностью данных. Это упрощает процесс хранения и управления бэкапами.

4. **Высокая скорость доступа:** S3 обеспечивает быстрый доступ к данным с минимальной задержкой. Это важно при необходимости восстановления данных из бэкапов.

5. **Требуется минимум управления:** В отличие от традиционных методов бэкапа, где требуется ручное копирование и обслуживание данных, S3-хранилище автоматизирует этот процесс, что уменьшает вероятность человеческих ошибок.

6. **Экономическая эффективность:** Стоимость хранения данных в S3 может быть более предсказуемой и гибкой по сравнению с традиционными решениями, где необходимо покупать и обновлять физическое оборудование.

7. **Гибкость классов хранения:** S3 предлагает различные классы хранения данных, включая стандартный, интеллектуальный и одноразовый доступ, позволяя выбрать оптимальный уровень доступности и стоимости в зависимости от требований.

Для нас это проект - можно выделить начало и окончание. Можно будет приступить к реализации когда будет решена проблема документирования инфраструктуры.
Считаю, что лучше это делать самим - по ресурсам не настолько затратно, а эти компетенции нужны внутри команды.
Аутсорс, как альтернатива, имеет плюс - эконит наш ресурс, минус - мы не будем владеть навыками.

### Необходимо
- Выяснить особенности с техничесокй стороны - как S3-хранилища предоставляет `Selectel`
- Проанализировать какую именно экономию это принесет (нужна будет помощь)

### Желательно (если Selectel предоставляет хранилища и нас устраивает их работа)
- Настроить создание бэкапов баз данных
- Настроить удаление старых и уже не нужных бэкапов (определить период)
- При сохранении новых изображений настроить немедленное сохранение их и в хранилище
- Проанализировать какие типы данных кроме баз данных и изображений требуют резервного копирования

### В идеале
- Реализовать микросервис управления бэкапами
- Отдельный микросервис для управления резервным копированием файлов

### Нынешний подход к бэкапам
- На текущий момент для изображений и прочих файлов автоматическое создание резервных копий не настроено. Настроено только для баз данных, причем нет управления глубиной периода для сохранения (не подчищаются бэкапы старые настолько, чтобы можно было признать их ненужными). Нет мониторинга заполненности сервера, выделенного для бэкапов. Пример потенциальной проблемы: из-за того, что бэкапы пишутся за все дни без ограничения периода, рано или поздно сервер будет заполнен. Т.к. мониторинга нет, мы об этом не узнаем. Если после этого что-то случится с базой, мы можем упереться в ситуацию, что бэкапы уже, н-р, месяц не пишутся, т.к. некуда, а файлов (картинок) нет вообще.

### Переход к использованию S3-хранилища для бэкапов позволит
- Предотвратить потерю данных за счет гарантии дублирования данных
- Не упираться в размер диска для хранения данных
- Какие проблемы прошлого это могло бы предотвратить: проблема со статьями в журнале, ускорить переезд на сервера Selectel



<br>
<br>
<a name="p4"><h2>Полноценное внедрение линтеров</h2></a>

### Ликбез
>https://habr.com/ru/companies/oleg-bunin/articles/487260/ - статья от ведущего разработчика Yii

### Вводные
**Линтеры (linters) - это инструменты, используемые в разработке программного обеспечения для анализа исходного кода на предмет соблюдения стандартов кодирования, стилевых рекомендаций и потенциальных проблем. Вот некоторые преимущества использования линтеров:**

1. **Соблюдение стандартов кодирования:** Линтеры позволяют поддерживать единый и стандартный стиль кодирования в рамках всей команды разработчиков. Это улучшает читаемость кода, делает его более последовательным и облегчает совместную работу.

2. **Выявление потенциальных проблем:** Линтеры идентифицируют потенциальные ошибки, баги и антипаттерны в коде на ранних этапах разработки. Это помогает предотвратить множество проблем, которые могли бы возникнуть в будущем.

3. **Улучшение качества кода:** Автоматический анализ кода линтерами способствует повышению качества кодовой базы. Исправление выявленных проблем помогает устранить некачественный код, что в итоге делает программу более надежной и эффективной.

4. **Снижение вероятности ошибок:** Линтеры помогают предотвращать многие распространенные ошибки, такие как опечатки, неправильное использование переменных и функций, неверные синтаксические конструкции и другие.

5. **Более быстрое обнаружение и исправление проблем:** Линтеры позволяют выявлять и исправлять проблемы в реальном времени, что способствует более быстрой разработке и снижает время, потраченное на отладку.

6. **Облегчение адаптации новых разработчиков:** Для новых членов команды линтеры могут служить своего рода руководством по стилю кодирования и структуре проекта, что упрощает адаптацию.

7. **Сокращение код-ревью:** Линтеры могут автоматически проверять код на соответствие стандартам, что уменьшает объем ручных проверок в процессе код-ревью.

8. **Автоматизация:** Линтеры могут быть интегрированы в процесс непрерывной интеграции и доставки (CI/CD), автоматически проверяя код перед его интеграцией и развертыванием.

9. **Профилактика безопасности:** Некоторые линтеры способны обнаруживать уязвимости и потенциальные проблемы безопасности в коде, что помогает защитить приложение от атак и утечек данных.

Использование линтеров в разработке программного обеспечения способствует повышению качества, надежности и эффективности кода, что имеет положительное влияние на весь процесс разработки и поддержки приложения.

### Необходимо
- Стандартизировать использование линтеров и правил локально
- Использовать стандарт для настройки линтеров на тестовых стендах

### Желательно
- Настроить автоматический запуск линтеров при обновлении веток в репозитории



<br>
<br>
<a name="p5"><h2>Переезд на GitHub</h2></a>

> Это под вопросом, т.к. компания имеет риски блокировки репозитория. Решаемо созданием резервных копий репозитория.

### Вводные
**`GitHub` - это одна из самых популярных платформ для хостинга и управления гит-репозиториями. GitHub интегрируется с множеством инструментов и сервисов, таких как уведомления, интеграция с чатами, управление задачами, анализ кода и другими. Особо выделю механизм поставки новых версий - `pull-requests` (пулл-реквесты). Что с ними возможно:**

1. **Эффективное код-ревью:** Пулл-реквесты представляют механизм для предложения изменений в коде проекта. Они позволяют разработчикам обсуждать и обозревать код друг друга перед его интеграцией в основную ветку. Это способствует обнаружению ошибок, улучшению качества кода и обмену знаний в команде.

2. **Прозрачность и отслеживаемость:** Пулл-реквесты позволяют подробно отслеживать изменения, вносимые в код, и вести обсуждение прямо на платформе. Это создает прозрачность внесенных изменений и позволяет легко возвращаться к обсуждениям и решениям.

3. **Ревизии кода:** Пулл-реквесты обеспечивают систему ревизий, где автор может вносить изменения в ответ на комментарии и предложения код-ревьюера. Это способствует взаимодействию между участниками и пошаговому улучшению кода.

4. **Разделение обязанностей:** Пулл-реквесты позволяют разработчикам разделять обязанности между теми, кто предлагает изменения, и теми, кто проводит код-ревью. Это улучшает качество кода и распределяет нагрузку между участниками команды.

5. **Обучение и передача опыта:** Пулл-реквесты могут служить инструментом обучения новых разработчиков. Они могут изучать и анализировать комментарии и рекомендации опытных коллег, что способствует передаче знаний и улучшению навыков.

6. **Интеграция с CI/CD:** Платформы, поддерживающие пулл-реквесты, часто позволяют интегрировать процессы непрерывной интеграции и доставки (CI/CD) прямо в пулл-реквест. Это автоматизирует тестирование и проверку кода перед его интеграцией.

### Необходимо (подготовка, которая нужна в любом случае - не важно переезем или нет)
- Вычленить все пароли из версионных конфигов, что потребует рефакторинга
- Либо поменять все текущие пароли, либо отказаться от истории репозитория

### Желательно
- Переместить репозиторий на платформу `GitHub`
- Внедрить использование пулл-реквестов

### В идеале
- Учитывая все остальные пункты - контейнеризацию, автоматическое тестирование, использование линтеров - настройть пайплайны для немедленного деплоя. Полноценный `CI/CD`!
